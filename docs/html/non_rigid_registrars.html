

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Non-rigid registration &mdash; valis &#34;1.0.0rc11&#34;
 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Serial rigid registration" href="serial_rigid.html" />
    <link rel="prev" title="Affine optimization" href="affine_optimizer.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/valis_logo_black_no_bg.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="slide_io.html">Slide I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Image pre-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_detectors.html">Feature detectors and descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_matcher.html">Feature matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="affine_optimizer.html">Affine optimization</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Non-rigid registration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#base-nonrigidregistrar">Base NonRigidRegistrar</a></li>
<li class="toctree-l2"><a class="reference internal" href="#base-nonrigidregistrarxy">Base NonRigidRegistrarXY</a></li>
<li class="toctree-l2"><a class="reference internal" href="#base-nonrigidregistrargroupwise">Base NonRigidRegistrarGroupwise</a></li>
<li class="toctree-l2"><a class="reference internal" href="#opticalflowwarper">OpticalFlowWarper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simpleelastixwarper">SimpleElastixWarper</a></li>
<li class="toctree-l2"><a class="reference internal" href="#simpleelastixgroupwisewarper">SimpleElastixGroupwiseWarper</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="serial_rigid.html">Serial rigid registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="serial_non_rigid.html">Serial non-rigid registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="viz.html">Visualization</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">valis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Non-rigid registration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/non_rigid_registrars.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="module-valis.non_rigid_registrars">
<span id="non-rigid-registration"></span><h1>Non-rigid registration<a class="headerlink" href="#module-valis.non_rigid_registrars" title="Permalink to this headline">¶</a></h1>
<p>Perform non-rigid registration</p>
<section id="base-nonrigidregistrar">
<h2>Base NonRigidRegistrar<a class="headerlink" href="#base-nonrigidregistrar" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.non_rigid_registrars.</span></span><span class="sig-name descname"><span class="pre">NonRigidRegistrar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar" title="Permalink to this definition">¶</a></dt>
<dd><p>Abstract class for non-rigid registration using displacement fields</p>
<p>Warps moving_img to align with fixed_img using backwards transformations
VALIS offers 3 implementations: dense optical flow (OpenCV),
SimpleElastix, and  groupwise SimpleElastix.
Displacement fields can come from other packages, indluding
SimpleITK, PIRT, DIPY, etc… Those other methods can be used by
subclassing the NonRigidRegistrar classes in VALIS.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.moving_img">
<span class="sig-name descname"><span class="pre">moving_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.moving_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image with shape (N,M) thata is  warp to align with <cite>fixed_img</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.fixed_img">
<span class="sig-name descname"><span class="pre">fixed_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.fixed_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image with shape (N,M) that <cite>moving_img</cite> is warped to align with.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.mask">
<span class="sig-name descname"><span class="pre">mask</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.mask" title="Permalink to this definition">¶</a></dt>
<dd><p>2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.shape">
<span class="sig-name descname"><span class="pre">shape</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of rows and columns in each image. Will be (N,M).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.10)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.grid_spacing">
<span class="sig-name descname"><span class="pre">grid_spacing</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.grid_spacing" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of pixels between deformation grid points.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.warped_image">
<span class="sig-name descname"><span class="pre">warped_image</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.warped_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Registered copy of <cite>moving_img</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.deformation_field_img">
<span class="sig-name descname"><span class="pre">deformation_field_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.deformation_field_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image showing deformation applied to a regular grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.backward_dx">
<span class="sig-name descname"><span class="pre">backward_dx</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.backward_dx" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the x-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.backward_dy">
<span class="sig-name descname"><span class="pre">backward_dy</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.backward_dy" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the y-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of registration method.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All NonRigidRegistrar subclasses need to have a calc() method,
which must at least take the following arguments:
moving_img, fixed_img, mask. calc() should return the displacement field
as a (2, N, M) numpy array, with the first element being an array of
displacements in the x-dimension, and the second element being an array of
displacements in the y-dimension.</p>
<p>Note that the NonRigidRegistrarXY subclass should be used if
corresponding points in moving and fixed images can be used
to aid the registration.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrar.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> (<em>dictionary</em>) – <p>Keyword: value dictionary of parameters to be used in reigstration.
Will get used in the calc() method.</p>
<p>In the case where simple ITK will be used, params should be
a SimpleITK.ParameterMap. Note that numeric values needd to be
converted to strings.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.calc">
<span class="sig-name descname"><span class="pre">calc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moving_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrar.calc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Cacluate displacement fields</p>
<p>Can record subclass specific atrributes here too</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>moving_img</strong> (<em>ndarray</em>) – Image to warp to align with <cite>fixed_img</cite>. Has shape (N, M).</p></li>
<li><p><strong>fixed_img</strong> (<em>ndarray</em>) – Image <cite>moving_img</cite> is warped to align with. Has shape (N, M).</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – 2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bk_dxdy</strong> – (2, N, M) numpy array of pixel displacements in
the x and y directions. dx = bk_dxdy[0], and dy=bk_dxdy[1].</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrar.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moving_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrar.register"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrar.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register images, warping moving_img to align with fixed_img</p>
<p>Uses backwards transforms to register images (i.e. aligning
fixed to moving), so the inverse transform needs to be used
to warp points from moving_img. This is automatically done in
warp_tools.warp_xy</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>moving_img</strong> (<em>ndarray</em>) – Image to warp to align with <cite>fixed_img</cite>.</p></li>
<li><p><strong>fixed_img</strong> (<em>ndarray</em>) – Image <cite>moving_img</cite> is warped to align with.</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – 2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p></li>
<li><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a><em>, </em><em>optional</em>) – Additional keyword arguments passed to NonRigidRegistrar.calc</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>warped_img</strong> (<em>ndarray</em>) – Moving image registered to align with fixed image.</p></li>
<li><p><strong>warped_grid</strong> (<em>ndarray</em>) – Image showing deformation applied to a regular grid.</p></li>
<li><p><strong>bk_dxdy</strong> (<em>ndarray</em>) – (2, N, M) numpy array of pixel displacements in
the x and y directions.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="base-nonrigidregistrarxy">
<h2>Base NonRigidRegistrarXY<a class="headerlink" href="#base-nonrigidregistrarxy" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.non_rigid_registrars.</span></span><span class="sig-name descname"><span class="pre">NonRigidRegistrarXY</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrarXY"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#valis.non_rigid_registrars.NonRigidRegistrar" title="valis.non_rigid_registrars.NonRigidRegistrar"><code class="xref py py-class docutils literal notranslate"><span class="pre">valis.non_rigid_registrars.NonRigidRegistrar</span></code></a></p>
<p>Abstract class for non-rigid registration using displacement fields</p>
<p>Subclass of NonRigidRegistrar that can (optionally) use corresponding
points (xy coordinates) to aid in the registration</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.moving_img">
<span class="sig-name descname"><span class="pre">moving_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.moving_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image with shape (N,M) thata is  warp to align with <cite>fixed_img</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.fixed_img">
<span class="sig-name descname"><span class="pre">fixed_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.fixed_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image with shape (N,M) that <cite>moving_img</cite> is warped to align with.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.mask">
<span class="sig-name descname"><span class="pre">mask</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.mask" title="Permalink to this definition">¶</a></dt>
<dd><p>2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.shape">
<span class="sig-name descname"><span class="pre">shape</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of rows and columns in each image. Will be (N,M).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.10)">tuple</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.grid_spacing">
<span class="sig-name descname"><span class="pre">grid_spacing</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.grid_spacing" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of pixels between deformation grid points/</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.warped_image">
<span class="sig-name descname"><span class="pre">warped_image</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.warped_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Registered copy of <cite>moving_img</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.deformation_field_img">
<span class="sig-name descname"><span class="pre">deformation_field_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.deformation_field_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image showing deformation applied to a regular grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.backward_dx">
<span class="sig-name descname"><span class="pre">backward_dx</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.backward_dx" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the x-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.backward_dy">
<span class="sig-name descname"><span class="pre">backward_dy</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.backward_dy" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the y-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of registration method.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.moving_xy">
<span class="sig-name descname"><span class="pre">moving_xy</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.moving_xy" title="Permalink to this definition">¶</a></dt>
<dd><p>(N, 2) array containing points in <cite>moving_img</cite> that correspond
to those in the fixed image.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.fixed_xy">
<span class="sig-name descname"><span class="pre">fixed_xy</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.fixed_xy" title="Permalink to this definition">¶</a></dt>
<dd><p>(N, 2) array containing points in <cite>fixed_img</cite> that correspond
to those in the moving image.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray, optional</p>
</dd>
</dl>
</dd></dl>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All NonRigidRegistrarXY subclasses need to have a calc() method,
which needs to at least take the following arguments:
moving_img, fixed_img, mask, moving_xy, fixed_xy.
calc() should return the warped moving image, warped regular grid,
and the displacement field as an (2, N, M) numpy array.</p>
<p>Note that NonRigidRegistrar should be used if corresponding points in
moving and fixed images can not be used to aid the registration.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrarXY.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> (<em>dictionary</em>) – <p>Keyword: value dictionary of parameters to be used in reigstration.
Will get used in the calc() method.</p>
<p>In the case where simple ITK will be used, params should be
a SimpleITK.ParameterMap. Note that numeric values needd to be
converted to strings.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.calc">
<span class="sig-name descname"><span class="pre">calc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moving_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Cacluate displacement fields</p>
<p>Can record subclass specific atrributes here too</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>moving_img</strong> (<em>ndarray</em>) – Image to warp to align with <cite>fixed_img</cite>. Has shape (N, M).</p></li>
<li><p><strong>fixed_img</strong> (<em>ndarray</em>) – Image <cite>moving_img</cite> is warped to align with. Has shape (N, M).</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – 2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bk_dxdy</strong> – (2, N, M) numpy array of pixel displacements in
the x and y directions. dx = bk_dxdy[0], and dy=bk_dxdy[1].</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarXY.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moving_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrarXY.register"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarXY.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register images, warping moving_img to align with fixed_img</p>
<p>Uses backwards transforms to register images (i.e. aligning
fixed to moving), so the inverse transform needs to be used
to warp points from moving_img. This is automatically done in
warp_tools.warp_xy</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>moving_img</strong> (<em>ndarray</em>) – Image to warp to align with <cite>fixed_img</cite>.</p></li>
<li><p><strong>fixed_img</strong> (<em>ndarray</em>) – Image <cite>moving_img</cite> is warped to align with.</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – 2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p></li>
<li><p><strong>moving_xy</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – (N, 2) array containing points in the <cite>moving_img</cite> that correspond
to those in <cite>fixed_img</cite>.</p></li>
<li><p><strong>fixed_xy</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – (N, 2) array containing points in the <cite>fixed_img</cite> that correspond
to those in the <cite>moving_img</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>warped_img</strong> (<em>ndarray</em>) – <cite>moving_img</cite> registered to align with <cite>fixed_img</cite>.</p></li>
<li><p><strong>warped_grid</strong> (<em>ndarray</em>) – Image showing deformation applied to a regular grid.</p></li>
<li><p><strong>bk_dxdy</strong> (<em>ndarray</em>) – (2, N, M) numpy array of pixel displacements in the
x and y directions.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="base-nonrigidregistrargroupwise">
<h2>Base NonRigidRegistrarGroupwise<a class="headerlink" href="#base-nonrigidregistrargroupwise" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.non_rigid_registrars.</span></span><span class="sig-name descname"><span class="pre">NonRigidRegistrarGroupwise</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrarGroupwise"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#valis.non_rigid_registrars.NonRigidRegistrar" title="valis.non_rigid_registrars.NonRigidRegistrar"><code class="xref py py-class docutils literal notranslate"><span class="pre">valis.non_rigid_registrars.NonRigidRegistrar</span></code></a></p>
<p>Performs groupwise non-rigid registration</p>
<p>This subclass can register a collection (&gt;= 2) of images,
and so is not limited to pairs of images.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.img_list">
<span class="sig-name descname"><span class="pre">img_list</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.img_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List of images, each with shape (N,M) that are to be co-registered</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>list of ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.mask">
<span class="sig-name descname"><span class="pre">mask</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.mask" title="Permalink to this definition">¶</a></dt>
<dd><p>2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.shape">
<span class="sig-name descname"><span class="pre">shape</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of rows and columns in each image. Will be (N,M).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>tuple of int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.warped_image">
<span class="sig-name descname"><span class="pre">warped_image</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.warped_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Registered copy of <cite>moving_img</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.deformation_field_img">
<span class="sig-name descname"><span class="pre">deformation_field_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.deformation_field_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image showing deformation applied to a regular grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.backward_dx">
<span class="sig-name descname"><span class="pre">backward_dx</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.backward_dx" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the x-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.backward_dy">
<span class="sig-name descname"><span class="pre">backward_dy</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.backward_dy" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the y-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.grid_spacing">
<span class="sig-name descname"><span class="pre">grid_spacing</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.grid_spacing" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of pixels between deformation grid points</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of registration method.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.size">
<span class="sig-name descname"><span class="pre">size</span></span><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of images that are being registered as a group</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrarGroupwise.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> (<em>dictionary</em>) – <p>Keyword: value dictionary of parameters to be used in reigstration.
Will get used in the calc() method.</p>
<p>In the case where simple ITK will be used, params should be
a SimpleITK.ParameterMap. Note that numeric values needd to be
converted to strings.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.NonRigidRegistrarGroupwise.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#NonRigidRegistrarGroupwise.register"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Register images in img_list</p>
<p>Uses backwards transforms to register images (i.e. aligning
fixed to moving), so the inverse transform needs to be used
to warp points from moving_img. This is automatically done in
warp_tools.warp_xy</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>img_list</strong> (<em>list of ndarray</em>) – List of I images, each with shape (N,M) that are to
be co-registered.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>warped_img</strong> (<em>list of ndarray</em>) – List of moving images registered to align with the fixed image.</p></li>
<li><p><strong>warped_grid</strong> (<em>list of ndarray</em>) – Image showing deformation applied to a regular grid.</p></li>
<li><p><strong>bk_dxdy</strong> (<em>list of ndarray</em>) – List numpy array of pixel displacements in the x and y directions
for each image. Has shape (I, N, M, 2).</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="opticalflowwarper">
<h2>OpticalFlowWarper<a class="headerlink" href="#opticalflowwarper" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.OpticalFlowWarper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.non_rigid_registrars.</span></span><span class="sig-name descname"><span class="pre">OpticalFlowWarper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optical_flow_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_grid_pts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.005</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">paint_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fold_penalty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothing_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#OpticalFlowWarper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.OpticalFlowWarper" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#valis.non_rigid_registrars.NonRigidRegistrar" title="valis.non_rigid_registrars.NonRigidRegistrar"><code class="xref py py-class docutils literal notranslate"><span class="pre">valis.non_rigid_registrars.NonRigidRegistrar</span></code></a></p>
<p>Use dense optical flow to register images.</p>
<p>Dense optical flow fields may not be diffeomorphic, and so
this class provides options to smooth displacement fields.</p>
<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.OpticalFlowWarper.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">optical_flow_obj</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_grid_pts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sigma_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.005</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">paint_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fold_penalty</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-06</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothing_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#OpticalFlowWarper.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.OpticalFlowWarper.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> (<em>dictionary</em>) – Keyword: value dictionary of parameters to be used in reigstration.
Will get used in the calc() method.</p></li>
<li><p><strong>optical_flow_obj</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.10)"><em>object</em></a>) – Object that will perform dense optical flow.</p></li>
<li><p><strong>n_grid_pts</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Number of gridpoints used to detect folds. Also the number
of gridpoints to use when regularizing he mesh when
<cite>method</cite> = “regularize”.</p></li>
<li><p><strong>paint_size</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Used to determine how much to resize the image to have
efficient inpainting. Larger values = longer processing time.
Only used if <cite>smoothing_method</cite> = “inpaint”.</p></li>
<li><p><strong>fold_penalty</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – How much to penalize folding/stretching. Larger values will make
the deformation field more uniform, which may or may not be
desired, as too much can remove all displacements.
Only used if <cite>smoothing_method</cite> = “regularize”</p></li>
<li><p><strong>sigma_ratio</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Determines the amount of Gaussian smoothing, as
sigma = max(shape) <a href="#id1"><span class="problematic" id="id2">*</span></a>sigma_ratio. Larger values do more
smoothing. Only used if <cite>smoothing_method</cite> is “gauss”.</p></li>
<li><p><strong>smoothing</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – <p>If “gauss”, then a Gaussian blur will be applied to the
deformation fields, using sigma defined by sigma_ratio.</p>
<p>If “inpaint”, folded regions will be detected and removed.
Folded regions will then be removed using inpainting.</p>
<p>If “regularize”, folded regions will be detected and
regularized using the method fescribed in
“Foldover-free maps in 50 lines of code” Garanzha et al. 2021.</p>
<p>If “None” then no smoothing will be applied.</p>
</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.OpticalFlowWarper.calc">
<span class="sig-name descname"><span class="pre">calc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moving_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_img</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#OpticalFlowWarper.calc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.OpticalFlowWarper.calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Cacluate displacement fields</p>
<p>Can record subclass specific atrributes here too</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>moving_img</strong> (<em>ndarray</em>) – Image to warp to align with <cite>fixed_img</cite>. Has shape (N, M).</p></li>
<li><p><strong>fixed_img</strong> (<em>ndarray</em>) – Image <cite>moving_img</cite> is warped to align with. Has shape (N, M).</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – 2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bk_dxdy</strong> – (2, N, M) numpy array of pixel displacements in
the x and y directions. dx = bk_dxdy[0], and dy=bk_dxdy[1].</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="simpleelastixwarper">
<h2>SimpleElastixWarper<a class="headerlink" href="#simpleelastixwarper" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixWarper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.non_rigid_registrars.</span></span><span class="sig-name descname"><span class="pre">SimpleElastixWarper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ammi_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bending_penalty_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixWarper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixWarper" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#valis.non_rigid_registrars.NonRigidRegistrarXY" title="valis.non_rigid_registrars.NonRigidRegistrarXY"><code class="xref py py-class docutils literal notranslate"><span class="pre">valis.non_rigid_registrars.NonRigidRegistrarXY</span></code></a></p>
<p>Uses SimpleElastix to register images</p>
<p>May optionally using corresponding points</p>
<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixWarper.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ammi_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bending_penalty_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kp_weight</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixWarper.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixWarper.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ammi_weight</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Weight given to the AdvancedMattesMutualInformation metric.</p></li>
<li><p><strong>bending_penalty_weight</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Weight given to the TransformBendingEnergyPenalty metric.</p></li>
<li><p><strong>kp_weight</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.10)"><em>float</em></a>) – Weight given to the CorrespondingPointsEuclideanDistanceMetric
metric. Only used if moving_xy and fixed_xy are provided as
arguments to the <cite>register()</cite> method.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixWarper.calc">
<span class="sig-name descname"><span class="pre">calc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">moving_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_img</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixWarper.calc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixWarper.calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform non-rigid registration using SimpleElastix.</p>
<p>Can include corresponding points to help in registration by providing
<cite>moving_xy</cite> and <cite>fixed_xy</cite>.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixWarper.get_default_params">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_default_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_spacing_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixWarper.get_default_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixWarper.get_default_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Get default parameters for registration with sitk.ElastixImageFilter</p>
<p>See <a class="reference external" href="https://simpleelastix.readthedocs.io/Introduction.html">https://simpleelastix.readthedocs.io/Introduction.html</a>
for advice on parameter selection</p>
</dd></dl>

</dd></dl>

</section>
<section id="simpleelastixgroupwisewarper">
<h2>SimpleElastixGroupwiseWarper<a class="headerlink" href="#simpleelastixgroupwisewarper" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.non_rigid_registrars.</span></span><span class="sig-name descname"><span class="pre">SimpleElastixGroupwiseWarper</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixGroupwiseWarper"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#valis.non_rigid_registrars.NonRigidRegistrarGroupwise" title="valis.non_rigid_registrars.NonRigidRegistrarGroupwise"><code class="xref py py-class docutils literal notranslate"><span class="pre">valis.non_rigid_registrars.NonRigidRegistrarGroupwise</span></code></a></p>
<p>Performs groupwise non-rigid registration using SimpleElastix.</p>
<p>SimpleElastixGroupwiseWarper can register a collection (&gt;= 2) of images,
and so is not limited to pairs of images.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.img_list">
<span class="sig-name descname"><span class="pre">img_list</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.img_list" title="Permalink to this definition">¶</a></dt>
<dd><p>List of images, each with shape (N,M) that are to be co-registered.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.10)">list</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.mask">
<span class="sig-name descname"><span class="pre">mask</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.mask" title="Permalink to this definition">¶</a></dt>
<dd><p>2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.shape">
<span class="sig-name descname"><span class="pre">shape</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of rows and columns in each image.
Will have shaape (N,M).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>tuple of int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.warped_image">
<span class="sig-name descname"><span class="pre">warped_image</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.warped_image" title="Permalink to this definition">¶</a></dt>
<dd><p>Registered copy of <cite>moving_img</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.deformation_field_img">
<span class="sig-name descname"><span class="pre">deformation_field_img</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.deformation_field_img" title="Permalink to this definition">¶</a></dt>
<dd><p>Image showing deformation applied to a regular grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.backward_dx">
<span class="sig-name descname"><span class="pre">backward_dx</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.backward_dx" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the x-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.backward_dy">
<span class="sig-name descname"><span class="pre">backward_dy</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.backward_dy" title="Permalink to this definition">¶</a></dt>
<dd><p>(N,M) array defining the displacements in the y-dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.grid_spacing">
<span class="sig-name descname"><span class="pre">grid_spacing</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.grid_spacing" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of pixels between deformation grid points.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.method">
<span class="sig-name descname"><span class="pre">method</span></span><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.method" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of registration method.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixGroupwiseWarper.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>params</strong> (<em>dictionary</em>) – <p>Keyword: value dictionary of parameters to be used in reigstration.
Will get used in the calc() method.</p>
<p>In the case where simple ITK will be used, params should be
a SimpleITK.ParameterMap. Note that numeric values needd to be
converted to strings.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.calc">
<span class="sig-name descname"><span class="pre">calc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixGroupwiseWarper.calc"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.calc" title="Permalink to this definition">¶</a></dt>
<dd><p>Cacluate displacement fields</p>
<p>Can record subclass specific atrributes here too</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>moving_img</strong> (<em>ndarray</em>) – Image to warp to align with <cite>fixed_img</cite>. Has shape (N, M).</p></li>
<li><p><strong>fixed_img</strong> (<em>ndarray</em>) – Image <cite>moving_img</cite> is warped to align with. Has shape (N, M).</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em>) – 2D array with shape (N,M) where non-zero pixel values are foreground,
and 0 is background, which is ignnored during registration. If None,
then all non-zero pixels in images will be used to create the mask.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>bk_dxdy</strong> – (2, N, M) numpy array of pixel displacements in
the x and y directions. dx = bk_dxdy[0], and dy=bk_dxdy[1].</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.get_default_params">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">get_default_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">img_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">grid_spacing_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.025</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/non_rigid_registrars.html#SimpleElastixGroupwiseWarper.get_default_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.non_rigid_registrars.SimpleElastixGroupwiseWarper.get_default_params" title="Permalink to this definition">¶</a></dt>
<dd><p>See <a class="reference external" href="https://simpleelastix.readthedocs.io/Introduction.html">https://simpleelastix.readthedocs.io/Introduction.html</a> for advice on parameter selection</p>
</dd></dl>

</dd></dl>

</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="serial_rigid.html" class="btn btn-neutral float-right" title="Serial rigid registration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="affine_optimizer.html" class="btn btn-neutral float-left" title="Affine optimization" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Chandler Gatenbee.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>