

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Serial non-rigid registration &mdash; valis &#34;1.0.0rc11&#34;
 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Visualization" href="viz.html" />
    <link rel="prev" title="Serial rigid registration" href="serial_rigid.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: black" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/valis_logo_black_no_bg.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="slide_io.html">Slide I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Image pre-processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_detectors.html">Feature detectors and descriptors</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature_matcher.html">Feature matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="affine_optimizer.html">Affine optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="non_rigid_registrars.html">Non-rigid registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="serial_rigid.html">Serial rigid registration</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Serial non-rigid registration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-valis.serial_non_rigid">Functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#classes">Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#nonrigidzimage">NonRigidZImage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serialnonrigidregistrar">SerialNonRigidRegistrar</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="viz.html">Visualization</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">valis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Serial non-rigid registration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/serial_non_rigid.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="serial-non-rigid-registration">
<h1>Serial non-rigid registration<a class="headerlink" href="#serial-non-rigid-registration" title="Permalink to this headline">¶</a></h1>
<section id="module-valis.serial_non_rigid">
<span id="functions"></span><h2>Functions<a class="headerlink" href="#module-valis.serial_non_rigid" title="Permalink to this headline">¶</a></h2>
<p>Classes and functions to perform serial non-rigid registration of a set of images</p>
<dl class="py function">
<dt class="sig sig-object py" id="valis.serial_non_rigid.register_images">
<span class="sig-prename descclassname"><span class="pre">valis.serial_non_rigid.</span></span><span class="sig-name descname"><span class="pre">register_images</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">non_rigid_reg_class=&lt;class</span> <span class="pre">'valis.non_rigid_registrars.OpticalFlowWarper'&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">non_rigid_reg_params=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dst_dir=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_img_f=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_to_fixed_xy=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">align_to_reference=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img_params=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compose_transforms=True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">qt_emitter=None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/serial_non_rigid.html#register_images"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.serial_non_rigid.register_images" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src</strong> (<a class="reference internal" href="serial_rigid.html#valis.serial_rigid.SerialRigidRegistrar" title="valis.serial_rigid.SerialRigidRegistrar"><em>SerialRigidRegistrar</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Either a SerialRigidRegistrar object that was used to optimally
align a series of images, or a string indicating where the images
to be aligned are located. If src is a string, the images should be
named such that they are read in the correct order, i.e. each
starting with a number.</p></li>
<li><p><strong>non_rigid_reg_class</strong> (<a class="reference internal" href="non_rigid_registrars.html#valis.non_rigid_registrars.NonRigidRegistrar" title="valis.non_rigid_registrars.NonRigidRegistrar"><em>NonRigidRegistrar</em></a>) – Uninstantiated NonRigidRegistrar class that will be used to
calculate the deformation fields between images.
By default this is an OpticalFlowWarper that uses the OpenCV
implementation of DeepFlow.</p></li>
<li><p><strong>non_rigid_reg_params</strong> (<em>dictionary</em><em>, </em><em>optional</em>) – Dictionary containing parameters {name: value} to be used to initialize
the NonRigidRegistrar.
In the case where simple ITK is used by the, params should be
a SimpleITK.ParameterMap. Note that numeric values nedd to be
converted to strings.</p></li>
<li><p><strong>dst_dir</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>optional</em>) – Top directory where aliged images should be save. SerialNonRigidRegistrar will
be in this folder, and aligned images in the “registered_images”
sub-directory. If None, the images will not be written to file</p></li>
<li><p><strong>reference_img_f</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><em>optional</em>) – Filename of image that will be treated as the center of the stack.
If None, the index of the middle image will be returned.</p></li>
<li><p><strong>moving_to_fixed_xy</strong> (<em>dict of list</em><em>, or </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a>) – <p>If <cite>moving_to_fixed_xy</cite> is a dict of list, then
Key = image name, value = list of matched keypoints between
each moving image and the fixed image.
Each element in the list contains 2 arrays:</p>
<ol class="arabic simple">
<li><p>Rigid registered xy in moving/current/from image</p></li>
<li><p>Rigid registered xy in fixed/next/to image</p></li>
</ol>
<p>To deterime which pairs of images will be aligned, use
<cite>warp_tools.get_alignment_indices</cite>. Can use <cite>get_imgs_from_dir</cite>
to see the order inwhich the images will be read, which will correspond
to the indices retuned by <cite>warp_tools.get_alignment_indices</cite>.</p>
<p>If <cite>src</cite> is a SerialRigidRegistrar and <cite>moving_to_fixed_xy</cite> is
True, then the matching features in the SerialRigidRegistrar will
be used. If False, then matching features will not be used.</p>
</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em><em>, </em><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – <p>Mask used in non-rigid alignments.</p>
<p>If an ndarray, it must have the same size as the other images.</p>
<p>If True, then the <cite>overlap_mask</cite> in the SerialRigidRegistrar
will be used.</p>
<p>If False or None, no mask will be used.</p>
</p></li>
<li><p><strong>name</strong> (<em>optional</em>) – Optional name for this SerialNonRigidRegistrar</p></li>
<li><p><strong>align_to_reference</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><em>bool</em></a><em>, </em><em>optional</em>) – Whether or not images should be aligne to a reference image
specified by <cite>reference_img_f</cite>. Will be set to True if
<cite>reference_img_f</cite> is provided.</p></li>
<li><p><strong>img_params</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a><em>, </em><em>optional</em>) – Dictionary of parameters to be used for each particular image.
Useful if images to be registered haven’t been processed.
Will be passed to <cite>non_rigid_reg_class</cite> init and register functions.
key = file name, value= dictionary of keyword arguments and values</p></li>
<li><p><strong>qt_emitter</strong> (<em>PySide2.QtCore.Signal</em><em>, </em><em>optional</em>) – Used to emit signals that update the GUI’s progress bars</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>nr_reg</strong> – SerialNonRigidRegistrar that has registeredt the images in <cite>src</cite></p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#valis.serial_non_rigid.SerialNonRigidRegistrar" title="valis.serial_non_rigid.SerialNonRigidRegistrar">SerialNonRigidRegistrar</a></p>
</dd>
</dl>
</dd></dl>

</section>
<section id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<section id="nonrigidzimage">
<h3>NonRigidZImage<a class="headerlink" href="#nonrigidzimage" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.serial_non_rigid.</span></span><span class="sig-name descname"><span class="pre">NonRigidZImage</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reg_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stack_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/serial_non_rigid.html#NonRigidZImage"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage" title="Permalink to this definition">¶</a></dt>
<dd><p>Class that store info about an image, including both
rigid and non-rigid registration parameters</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.image">
<span class="sig-name descname"><span class="pre">image</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.image" title="Permalink to this definition">¶</a></dt>
<dd><p>Original, unwarped image with shape (P, Q)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.name">
<span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of image.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.stack_idx">
<span class="sig-name descname"><span class="pre">stack_idx</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.stack_idx" title="Permalink to this definition">¶</a></dt>
<dd><p>Position of image in the stack</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.moving_xy">
<span class="sig-name descname"><span class="pre">moving_xy</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.moving_xy" title="Permalink to this definition">¶</a></dt>
<dd><p>(V, 2) array containing points in the moving image that correspond
to those in the fixed image. If these are provided, non_rigid_reg_class
should be a subclass of non_rigid_registrars.NonRigidRegistrarXY</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.fixed_xy">
<span class="sig-name descname"><span class="pre">fixed_xy</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.fixed_xy" title="Permalink to this definition">¶</a></dt>
<dd><p>(V, 2) array containing points in the fixed image that correspond
to those in the moving image</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.bk_dxdy">
<span class="sig-name descname"><span class="pre">bk_dxdy</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.bk_dxdy" title="Permalink to this definition">¶</a></dt>
<dd><p>(2, N, M) numpy array of pixel displacements in
the x and y directions from the reference image.
dx = bk_dxdy[0], and dy=bk_dxdy[1].
Used to warp images</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.fwd_dxdy">
<span class="sig-name descname"><span class="pre">fwd_dxdy</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.fwd_dxdy" title="Permalink to this definition">¶</a></dt>
<dd><p>Inversion of bk_dxdy. dx = fwd_dxdy[0], and dy=fwd_dxdy[1].
Used to warp points</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.warped_grid">
<span class="sig-name descname"><span class="pre">warped_grid</span></span><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.warped_grid" title="Permalink to this definition">¶</a></dt>
<dd><p>Image showing deformation applied to a regular grid.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.serial_non_rigid.NonRigidZImage.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">reg_obj</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stack_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fixed_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/serial_non_rigid.html#NonRigidZImage.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.serial_non_rigid.NonRigidZImage.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>ndarray</em>) – Original, unwarped image with shape (P, Q)</p></li>
<li><p><strong>name</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a>) – Name of image.</p></li>
<li><p><strong>stack_idx</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><em>int</em></a>) – Position of image in the stack</p></li>
<li><p><strong>moving_xy</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – (V, 2) array containing points in the moving image that correspond
to those in the fixed image. If these are provided, non_rigid_reg_class
should be a subclass of non_rigid_registrars.NonRigidRegistrarXY</p></li>
<li><p><strong>fixed_xy</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – (V, 2) array containing points in the fixed image that correspond
to those in the moving image</p></li>
<li><p><strong>mask</strong> (<em>ndarray</em><em>, </em><em>optional</em>) – Mask covering area to be registered.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="serialnonrigidregistrar">
<h3>SerialNonRigidRegistrar<a class="headerlink" href="#serialnonrigidregistrar" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">valis.serial_non_rigid.</span></span><span class="sig-name descname"><span class="pre">SerialNonRigidRegistrar</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_img_f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_to_fixed_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">align_to_reference</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compose_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/serial_non_rigid.html#SerialNonRigidRegistrar"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar" title="Permalink to this definition">¶</a></dt>
<dd><p>Class that performs serial non-rigid registration, based on results SerialRigidRegistrar</p>
<p>A SerialNonRigidRegistrar finds the deformation fields that will non-rigidly align
a series of images, using the rigid registration parameters found by a
SerialRigidRegistrar object. There are two types of non-rigid registration
methods:</p>
<p>#. Images are aligned towards a reference image, which may or may not
be at the center of the stack. In this case, the image directly “above” the
reference image is aligned to the reference image, after which the image 2 steps
above the reference image is aligned to the 1st (now aligned) image above
the reference image, and so on. The process is similar when aligning images
“below” the reference image.</p>
<p>#. All images are aligned simultaneously, and so a reference image is not
# required. An example is the SimpleElastix groupwise registration.</p>
<p>Similar to SerialRigidRegistrar, SerialNonRigidRegistrar creates a list
and dictionary of NonRigidZImage objects each of which contains information
related to the non-rigid registration, including the original rigid
transformation matrices, and the calculated deformation fields.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.name">
<span class="sig-name descname"><span class="pre">name</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.name" title="Permalink to this definition">¶</a></dt>
<dd><p>Optional name of this SerialNonRigidRegistrar</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a>, optional</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.from_rigid_reg">
<span class="sig-name descname"><span class="pre">from_rigid_reg</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.from_rigid_reg" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether or not the images are from a SerialRigidRegistrar</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)">bool</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.ref_image_name">
<span class="sig-name descname"><span class="pre">ref_image_name</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.ref_image_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Name of mage that is being treated as the “center” of the stack.
For example, this may be associated with an H+E image that is
the 2nd image in a stack of 7 images.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)">str</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.size">
<span class="sig-name descname"><span class="pre">size</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.size" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of images to align</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)">int</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.shape">
<span class="sig-name descname"><span class="pre">shape</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.shape" title="Permalink to this definition">¶</a></dt>
<dd><p>Shape of each image to register. Must be the same for all images</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>tuple of int</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.non_rigid_obj_dict">
<span class="sig-name descname"><span class="pre">non_rigid_obj_dict</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.non_rigid_obj_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary, where each key is the name of a NonRigidZImage, and
the value is the assocatiated NonRigidZImage</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)">dict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.non_rigid_reg_params">
<span class="sig-name descname"><span class="pre">non_rigid_reg_params</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.non_rigid_reg_params" title="Permalink to this definition">¶</a></dt>
<dd><p>Dictionary containing parameters {name: value} to be used to initialize
the NonRigidRegistrar.
In the case where simple ITK is used by the, params should be
a SimpleITK.ParameterMap. Note that numeric values nedd to be
converted to strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dictionary</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.mask">
<span class="sig-name descname"><span class="pre">mask</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.mask" title="Permalink to this definition">¶</a></dt>
<dd><p>Mask used in non-rigid alignments, with shape (P, Q).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.mask_bbox_xywh">
<span class="sig-name descname"><span class="pre">mask_bbox_xywh</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.mask_bbox_xywh" title="Permalink to this definition">¶</a></dt>
<dd><p>Bounding box of <cite>mask</cite> (top left x, top left y, width, height)</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.summary">
<span class="sig-name descname"><span class="pre">summary</span></span><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.summary" title="Permalink to this definition">¶</a></dt>
<dd><p>Pandas dataframe containing the median distance between matched
features before and after registration.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>Dataframe</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reference_img_f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">moving_to_fixed_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">align_to_reference</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">compose_transforms</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/serial_non_rigid.html#SerialNonRigidRegistrar.__init__"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.__init__" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>src</strong> (<a class="reference internal" href="serial_rigid.html#valis.serial_rigid.SerialRigidRegistrar" title="valis.serial_rigid.SerialRigidRegistrar"><em>SerialRigidRegistrar</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><em>str</em></a><em>, </em><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a>) – <p>A SerialRigidRegistrar object that was used to optimally
align a series of images.</p>
<p>If a string, it should indicating where the images
to be aligned are located. If src is a string, the images should be
named such that they are read in the correct order, i.e. each
starting with a number.</p>
<p>If a dictionary, it should contain the following key, value pairs:</p>
<p>”img_list” : list of images to register
“img_f_list” : list of filenames of each image
“name_list” : list of image names. If not provided, will come from file names
“mask_list” list of masks for each image</p>
</p>
</dd>
</dl>
<dl>
<dt>reference_img_f<span class="classifier">str, optional</span></dt><dd><p>Filename of image that will be treated as the center of the stack.
If None, the index of the middle image will be returned.</p>
</dd>
<dt>moving_to_fixed_xy<span class="classifier">dict of list, or bool</span></dt><dd><p>If <cite>moving_to_fixed_xy</cite> is a dict of list, then
Key = image name, value = list of matched keypoints between
each moving image and the fixed image.
Each element in the list contains 2 arrays:</p>
<ol class="arabic simple">
<li><p>Rigid registered xy in moving/current/from image</p></li>
<li><p>Rigid registered xy in fixed/next/to image</p></li>
</ol>
<p>To deterime which pairs of images will be aligned, use
<cite>get_alignment_indices</cite>. Can use <cite>get_imgs_from_dir</cite>
to see the order inwhich the images will be read, which will correspond
to the indices retuned by <cite>get_alignment_indices</cite>.</p>
<p>If <cite>src</cite> is a SerialRigidRegistrar and <cite>moving_to_fixed_xy</cite> is
True, then the matching features in the SerialRigidRegistrar will
be used. If False, then matching features will not be used.</p>
</dd>
<dt>mask<span class="classifier">ndarray, bool, optional</span></dt><dd><p>Mask used for all non-rigid alignments.</p>
<p>If an ndarray, it must have the same size as the other images.</p>
<p>If True, then the <cite>overlap_mask</cite> in the SerialRigidRegistrar
will be used.</p>
<p>If False or None, no mask will be used.</p>
</dd>
<dt>name<span class="classifier">optional</span></dt><dd><p>Optional name for this SerialNonRigidRegistrar</p>
</dd>
<dt>align_to_reference<span class="classifier">bool, optional</span></dt><dd><p>Whether or not images should be aligned to a reference image
specified by <cite>reference_img_f</cite>.</p>
</dd>
<dt>img_params<span class="classifier">dict, optional</span></dt><dd><p>Dictionary of parameters to be used for each particular image.
Useful if images to be registered haven’t been processed.
Will be passed to <cite>non_rigid_reg_class</cite> init and register functions.
key = file name, value= dictionary of keyword arguments and values</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.register">
<span class="sig-name descname"><span class="pre">register</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">non_rigid_reg_class</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">non_rigid_reg_params</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">img_params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/serial_non_rigid.html#SerialNonRigidRegistrar.register"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.register" title="Permalink to this definition">¶</a></dt>
<dd><p>Non-rigidly align images, either as a group or serially</p>
<p>Images will be registered serially if <cite>non_rigid_reg_class</cite> is a
subclass of NonRigidRegistrarGroupwise, then groupwise registration
will be conductedd. If <cite>non_rigid_reg_class</cite> is a subclass of
NonRigidRegistrar then images will be aligned serially.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>non_rigid_reg_class</strong> (<a class="reference internal" href="non_rigid_registrars.html#valis.non_rigid_registrars.NonRigidRegistrar" title="valis.non_rigid_registrars.NonRigidRegistrar"><em>NonRigidRegistrar</em></a><em>, </em><a class="reference internal" href="non_rigid_registrars.html#valis.non_rigid_registrars.NonRigidRegistrarGroupwise" title="valis.non_rigid_registrars.NonRigidRegistrarGroupwise"><em>NonRigidRegistrarGroupwise</em></a>) – Uninstantiated NonRigidRegistrar or NonRigidRegistrarGroupwise class
that will be used to calculate the deformation fields between images</p></li>
<li><p><strong>non_rigid_reg_params</strong> (<em>dictionary</em><em>, </em><em>optional</em>) – Dictionary containing parameters {name: value} to be used to initialize
the NonRigidRegistrar.
In the case where simple ITK is used by the, params should be
a SimpleITK.ParameterMap. Note that numeric values nedd to be
converted to strings.</p></li>
<li><p><strong>img_params</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.10)"><em>dict</em></a><em>, </em><em>optional</em>) – Dictionary of parameters to be used for each particular image.
Useful if images to be registered haven’t been processed.
Will be passed to <cite>non_rigid_reg_class</cite> init and register functions.
key = file name, value= dictionary of keyword arguments and values</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="valis.serial_non_rigid.SerialNonRigidRegistrar.summarize">
<span class="sig-name descname"><span class="pre">summarize</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/valis/serial_non_rigid.html#SerialNonRigidRegistrar.summarize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#valis.serial_non_rigid.SerialNonRigidRegistrar.summarize" title="Permalink to this definition">¶</a></dt>
<dd><p>Summarize alignment error</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>summary_df</strong> – Pandas dataframe containin the registration error of the
alignment between each image and the previous one in the stack.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>Dataframe</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="viz.html" class="btn btn-neutral float-right" title="Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="serial_rigid.html" class="btn btn-neutral float-left" title="Serial rigid registration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Chandler Gatenbee.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>